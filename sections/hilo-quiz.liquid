{% assign steps = page.metafields.quiz.quiz.value  %}
<form action="https://apiv2.shopflex.io/auth/trigger/boksbfk5yw?customerid={{ customer.id }}" method="post" enctype="multipart/form-data">
  <button class="form__submit-btn" type="submit">submit</button>
</form>
<div class="page-width " x-data="{  formData: {  name: '', gender: '', age: 'f25', f21: '', f22: '', f23: '', f31: '', f32: '', f33: '', preoccupations: '', f41: '', f42: '', f43: ''}, step: 1, activeStepColor: '#fbbf24',  selected: []}" style="margin-bottom:100px;" >
  <div class="etapas grid grid-cols-4 text-center justify-center">
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10 " @click="step = 1;" :class="{ 'active-step': step === 1 }">
  1
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 2;" :class="{ 'active-step': step === 2 }">
  2
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 3;" :class="{ 'active-step': step === 3 }">
  3
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 4;" :class="{ 'active-step': step === 4}">
  4
  </div>
     <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 5;" :class="{ 'active-step': step === 5}">
  5
  </div>
</div>

<div class="form-quiz">

        {% for step in steps %}
        <div class="step{{ forloop.index }} border-2  rounded-sm  p-20 m-20" x-show="step === {{ forloop.index }}">
          {% if forloop.index == 4  %}

    <fieldset class="mb-10">
            <legend>En ce moment, quelles sont les pr√©occupations que vous avez vis-√†-vis de votre peau ? (s√©lectionnez 1 √† 3 r√©ponses)</legend>
 <div>
        <input type="checkbox" id="Imperfections" name="Imperfections" value="Imperfections"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Imperfections'" x-on:click="formData.preoccupations = 'Imperfections'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Imperfections">Imperfections</label>
    </div>

    <div>
        <input type="checkbox" id="Signes de lage" name="Signes de lage" value="Signes de lage"
        x-model="selected"
           x-bind:checked="formData.preoccupations === 'Signes de lage'" x-on:click="formData.preoccupations = 'Signes de lage'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Signes de lage">Signes de l'√¢ge</label>
    </div>

    <div>
        <input type="checkbox" id="Deshydratation" name="Deshydratation" value="Deshydratation"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Deshydratation'" x-on:click="formData.preoccupations = 'Deshydratation'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Deshydratation">D√©shydratation</label>
    </div>

    <div>
        <input type="checkbox" id="Rougeurs, irritations cutan√©es" name="Rougeurs, irritations cutan√©es" value="Rougeurs, irritations cutan√©es"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Rougeurs'" x-on:click="formData.preoccupations = 'Rougeurs'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Rougeurs, irritations cutan√©es">Rougeurs, irritations cutan√©es</label>
    </div>

    <div>
        <input type="checkbox" id="Eclat" name="Eclat" value="Eclat"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Eclat'" x-on:click="formData.preoccupations = 'Eclat'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Eclat">Eclat</label>
    </div>

    <div>
        <input type="checkbox" id="Brillance" name="Brillance" value="Brillance"
        x-model="selected"

          x-bind:checked="formData.preoccupations === 'Brillance'" x-on:click="formData.preoccupations = 'Brillance'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Brillance">Brillance</label>
    </div>
        <button @click="step++;"  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Siguiente</button>
</fieldset>
            {% else %}
        {% for field in step.fields %}
            <div class="faq{{ forloop.index }}  mb-10">
             <fieldset>
             <legend>{{ field.label }}</legend>
             {% for option in field.options %}
             {% if field.type == "radio" %}
             <label>
             <input type="radio" name="{{ field.name }}" value="{{ option.value }}"
                x-bind:checked="formData.{{ field.name }} === '{{ option.value }}'" 
                x-on:click="formData.{{ field.name }} = '{{ option.value }}'"> {{ option.label }}
             </label>
             {% else %}
             <input id="prenom" type="text" placeholder="{{ option.value }}"  x-model="formData.name">
             {% endif %}
             {% endfor %}
               <fieldset>
               </div>
           {% endfor %}
           {% if forloop.index != 5  %}
         <button @click="step++;"  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Siguiente</button>
                 {% else == 5 %}
             <button @click="step++;"
              class="bg-red-500 hover:red-700 text-white font-bold py-2 px-4 rounded">Finalizar</button>
            {% endif %}
              {% endif %}
        </div>
        {% endfor %}

  <div class="step6 " x-show="step === 6">
    {% if customer %}
    <div class="div-with-svg"> <h2 class="text-center">{{ customer.first_name }}, VOICI VOS RESULTATS :</h2>
      <p class="text-center">Gr√¢ce √† vos r√©ponses, nous avons pu identifier vos caract√©ristiques de peau afin de vous proposer les capsules d'huiles v√©g√©tales les plus adapt√©es pour personnaliser vos cosm√©tiques et prendre soin de votre visage. Si cette combinaison ne vous convient pas, ou si vous avez des allergies, vous pourrez modifier vos huiles v√©g√©tales √† l'√©tape suivante.</p>
    </div>
    <div class="two-columns flex gap-x-40 mt-20">
      <div class="one-column  flex-1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10 ">
        <h3 class="text-center">          VOS TENDANCES DE PEAU DU MOMENT        </h3>
        <p>‚ú® Vous avez une peau √† tendance mixte. Ce type de peau est complexe car c‚Äôest un m√©lange de diff√©rentes caract√©ristiques de peau en fonction des zones du visage. La peau est g√©n√©ralement grasse sur la zone T du visage (front, nez, menton) et plus s√®che sur le reste du visage. Des sensations de tiraillements peuvent √™tre ressenties et elle peut pr√©senter des imperfections.
        </p>
        <p>‚ú® Votre peau commence √† se rel√¢cher et la production naturelle de collag√®ne de votre corps diminue. On conseille de commencer √† traiter le vieillissement cutan√© aux alentours de 25 ans afin de pr√©venir l‚Äôapparition de rides et ridules.</p>
        <p>‚ú® Votre peau est d√©shydrat√©e. Elle manque d‚Äôeau, ce qui alt√®re le film hydrolipidique de l‚Äô√©piderme et affaiblit la barri√®re cutan√©e. La d√©shydratation peut causer des tiraillements, des irritations, un manque de souplesse et une perte d‚Äô√©clat.</p>
        
      </div>
      <div class="one-column flex-1 result border-2  rounded-sm border-teal-600 bg-teal-300 p-10">
        <h3 class="text-center">VOTRE MATCH PARFAIT DU MOMENT</h3>
        <p class="text-left">Ces huiles v√©g√©tales sont connues pour les propri√©t√©s suivantes* :</p>
        <div class="container-result flex" >
          <div class="container-image"><img style="width:32px;" src="https://cdn.shopify.com/s/files/1/0716/5509/6615/files/Actif_huile_de_carotte_df45e5b7-7abc-4cac-87bd-f9371df5ddfe.svg?v=1678245001&width=70">
          </div>
          <div class="container-result-p"><p>Huile de noisette : anti-imperfections, r√©gulatrice de s√©bum et r√©paratrice</p>
          </div>
        </div>
        <div class="container-result flex" >
          <div class="container-image"><img style="width:32px;"  src="https://cdn.shopify.com/s/files/1/0716/5509/6615/files/Actif_huile_de_carotte_df45e5b7-7abc-4cac-87bd-f9371df5ddfe.svg?v=1678245001&width=70">
          </div>
          <div class="container-result-p"><p>Huile de noisette : anti-imperfections, r√©gulatrice de s√©bum et r√©paratrice</p>
          </div>
        </div>
        <div class="container-result flex" >
          <div class="container-image"><img style="width:32px;"  src="https://cdn.shopify.com/s/files/1/0716/5509/6615/files/Actif_huile_de_carotte_df45e5b7-7abc-4cac-87bd-f9371df5ddfe.svg?v=1678245001&width=70">
          </div>
          <div class="container-result-p"><p>Huile de noisette : anti-imperfections, r√©gulatrice de s√©bum et r√©paratrice</p>
          </div>
        </div>
          

      </div>
            </div>
            <div class="container-routine mt-20">
      <h2 class="text-center">VOTRE ROUTINE PERSONNALISEE</h2>
      <p class="text-center">Voici les soins personnalis√©s √† l'image de votre peau avec votre match parfait du moment (indiqu√© ci-dessus).</p>
      <p class="text-center">Tous nos produits sont rechargeables √† l'infini (et au del√†‚Ä¶ üöÄ) pour √©conomiser 95,6% de plastiques.<br>
        Vous pourrez choisir √† l'√©tape suivante, pour chaque produit, si vous souhaitez le format pot + recharge (premi√®re utilisation) ou juste la recharge √† clipser dans votre pot Hilo.</p>
      <a href="#" class="button btn">J'ajoute ma routine au panier</a>
    </div>
        </div>
      {% else %}
 {% include 'register-quiz' %}


      {% endif %}
  </div>
  
</div>
       



 
  <div style="margin-bottom:500px;">
{% comment %}
      <template  x-if="(formData.f31 == 'f31a' || formData.f31 == 'f31b')  && (formData.f32 == 'f32a' || formData.f31 == 'f32b' ) && ( formData.f33 == 'f33a' || formData.f33 == 'f33b' )">
          <p>Piel Deshidratada</p>
        </template>
      <template  x-if="formData.f31 == 'f31c' && formData.f32 == 'f32c' &&  formData.f33 == 'f33c'">
          <p>Piel No Deshidratada</p>
        </template>

    
    <p>Primeros Casos:<br> </p>
    <template x-if="formData.age == 'f25'">
        <div>    Piel no madura<br></div>
   </template>
        </template>
          <template x-if="formData.age != 'f25'">
        <div>      Piel Madura<br></div>
    </template>
      
     <template x-if="formData.f21 == 'f21c'  && formData.f22 == 'f22c' &&  formData.f23 == 'f23d'">
          <p>piel normale</p>
          </template>
    
        <template  x-if="formData.f21 == 'f21a'  && formData.f22 == 'f22c' &&  formData.f23 == 'f23b'">
          <p>piel seca</p>
        </template>
       
        <template  x-if="formData.f21 == 'f21b'  && formData.f22 == 'f22b' &&  formData.f23 == 'f23c'">
          <p>piel mixta</p>
        </template>
       
       <template  x-if="formData.f21 == 'f21a'  && formData.f22 == 'f22a' &&  formData.f23 == 'f23a'">
          <p>grasa</p>
        </template>

    
     
    
    <hr>

   
         <template  x-if="formData.preoccupations.includes == 'Brillancee' || formData.preoccupations.includes == 'Deshydratation' ">
          <p>es brillance o D√©shydratation</p>
        </template>
      
      <template x-if="['Brillance'].some(val => selected.includes(val))">
    
      </template>

    <template x-if="['Deshydratation'].some(val => selected.includes(val)) || ['Brillance'].some(val => selected.includes(val))">
        <p>Elegiste Deshydratation o Brillance</p>
      </template>

     <div x-text="selected"></div>
  {% endcomment %} 
      
       <template  x-if="formData.age !== 'f25' && formData.f21 == 'f21a'  && formData.f22 == 'f22c' &&  formData.f23 == 'f23a' && formData.f31 == 'f31a'  && formData.f32 == 'f32a' && formData.f33 == 'f33a'">
          <p>J‚Äôai la peau mature / s√®che / d√©shydrat√©e</p>
        </template>
<h2>Resultados:</h2>
  <ul>
    <template x-for="(value, key) in formData">
      <li x-model="formData.name"><strong>{{ key }}:</strong> {{ value }}</li>
    </template>
  </ul>

    
  <div>
    
  

    
</div>
  </div>
  <script>
  {% comment %} 



function customerupdate(formData2) {

const storeName = 'hilo-cosmetiques.myshopify.com';
const customerId = '6953631580455'; // replace with the ID of the customer you want to fetch
const metafieldId = '29093746475303'; // replace with the ID of the customer you want to fetch
var accessToken = '';

// Construir la URL de la API de Shopify para actualizar el cliente
const url = `https://${storeName}/admin/api/2023-04/customers/${customerId}/metafields/${metafieldId}.json`;

// Construct the request options, including the new value of the metafield
const options = {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'X-Shopify-Access-Token': accessToken,
  },
  body: JSON.stringify({
    metafield: {
      value: '{"data":"nacho2"}',
    },
  }),
};

// Send the PUT request to update the customer metafield
fetch(url, options)
  .then((response) => {
    if (response.ok) {
      return response.json();
    }
    throw new Error('Error updating customer metafield');
  })
  .then((data) => {
    console.log('Customer metafield updated successfully:', data);
  })
  .catch((error) => {
    console.error('Error updating customer metafield:', error);
  });


};
{% endcomment %}


</script>


<style>
  .step1 {
 background:#fdf8ed; border-color:#f5dfa5;
  }
  .step2 {
    background:#f2f8f1; border-color:#cde4ca;
  }
  .step3 {
    border-color:#b7daf3; background:#eef6fc;
    
  }
  .step4 {
    border-color:#F8C8D3; background:#FDEDF1;
  }
   .step5 {
    border-color:#F8C8D3; background:#FDEDF1;
  }
  
  label {
  display:block;
}
  legend {
    font-weight:500;
    margin-bottom:20px;
  }
  .active-step {
  background-color: #fbbf24;
}
</style>
{% schema %}
  {
    "name": "Section name",
    "settings": [],
   "presets": [
    {
      "name": "Quiz",
      "category": "Quiz by Sections.design",
      "blocks": [
      ]
    }
  ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}