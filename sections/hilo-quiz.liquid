{% assign steps = page.metafields.quiz.quiz.value  %}


<div class="page-width " x-data="{ formData2 : '' , result: '', formData: {  name: '', gender: '', age: 'f25', f21: '', f22: '', f23: '', preoccupations: '', f41: '', f42: '', f43: ''}, step: 1, activeStepColor: '#fbbf24',  selected: []}" style="margin-bottom:100px;" >
  <div class="etapas grid grid-cols-4 text-center justify-center">
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10 " @click="step = 1;" :class="{ 'active-step': step === 1 }">
  1
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 2;" :class="{ 'active-step': step === 2 }">
  2
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 3;" :class="{ 'active-step': step === 3 }">
  3
  </div>
  <div class="etapa1 border-2  rounded-sm border-teal-600 bg-teal-300 p-10" @click="step = 4;" :class="{ 'active-step': step === 4}">
  4
  </div>
</div>

<div class="form-quiz">

        {% for step in steps %}
        <div class="step{{ forloop.index }} border-2  rounded-sm  p-20 m-20" x-show="step === {{ forloop.index }}">
          {% if forloop.index == 3  %}

    <fieldset class="mb-10">
            <legend>En ce moment, quelles sont les préoccupations que vous avez vis-à-vis de votre peau ? (sélectionnez 1 à 3 réponses)</legend>
 <div>
        <input type="checkbox" id="Imperfections" name="Imperfections" value="Imperfections"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Imperfections'" x-on:click="formData.preoccupations = 'Imperfections'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Imperfections">Imperfections</label>
    </div>

    <div>
        <input type="checkbox" id="Signes de lage" name="Signes de lage" value="Signes de lage"
        x-model="selected"
           x-bind:checked="formData.preoccupations === 'Signes de lage'" x-on:click="formData.preoccupations = 'Signes de lage'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Signes de lage">Signes de l'âge</label>
    </div>

    <div>
        <input type="checkbox" id="Déshydratation" name="Déshydratation" value="Déshydratation"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Déshydratation'" x-on:click="formData.preoccupations = 'Déshydratation'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Déshydratation">Déshydratation</label>
    </div>

    <div>
        <input type="checkbox" id="Rougeurs, irritations cutanées" name="Rougeurs, irritations cutanées" value="Rougeurs, irritations cutanées"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Rougeurs'" x-on:click="formData.preoccupations = 'Rougeurs'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Rougeurs, irritations cutanées">Rougeurs, irritations cutanées</label>
    </div>

    <div>
        <input type="checkbox" id="Eclat" name="Eclat" value="Eclat"
        x-model="selected"
          x-bind:checked="formData.preoccupations === 'Eclat'" x-on:click="formData.preoccupations = 'Eclat'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Eclat">Eclat</label>
    </div>

    <div>
        <input type="checkbox" id="Brillance" name="Brillance" value="Brillance"
        x-model="selected"

          x-bind:checked="formData.preoccupations === 'Brillancee'" x-on:click="formData.preoccupations = 'Brillance'"
        x-on:change="if (selected.length > 3) { selected.pop(); }">
        <label for="Brillance">Brillance</label>
    </div>
</fieldset>
            {% else %}
        {% for field in step.fields %}
            <div class="faq{{ forloop.index }}  mb-10">
             <fieldset>
             <legend>{{ field.label }}</legend>
             {% for option in field.options %}
             {% if field.type == "radio" %}
             <label>
             <input type="radio" name="{{ field.name }}" value="{{ option.value }}"
                x-bind:checked="formData.{{ field.name }} === '{{ option.value }}'" 
                x-on:click="formData.{{ field.name }} = '{{ option.value }}'"> {{ option.label }}
             </label>
             {% else %}
             <input id="prenom" type="text" placeholder="{{ option.value }}"  x-model="formData.name">
             {% endif %}
             {% endfor %}
               <fieldset>
               </div>
           {% endfor %}
           {% if forloop.index != 4  %}
         <button @click="step++;"  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Siguiente</button>
                 {% else == 4 %}
                <button  @click="customerupdate(formData2)"
              class="bg-red-500 hover:red-700 text-white font-bold py-2 px-4 rounded">Finalizar</button>
            {% endif %}
              {% endif %}
        </div>
        {% endfor %}
</div>
       



 
  <div style="margin-bottom:500px;">
    <p>Primeros Casos:<br> </p>
    <template x-if="formData.age == 'f25'">
        <div>    Piel no madura<br></div>
      <p>tipo de piel</p>
        <template  x-if="formData.f21 == 'f21a'  && formData.f22 == 'f22a' &&  formData.f23 == 'f23b'">
          <p>piel seca</p>
        </template>
        <template  x-if="formData.f21 == 'f21b'  && formData.f22 == 'f22b' &&  formData.f23 == 'f23b'">
          <p>piel mixta</p>
        </template>
       
       <template  x-if="formData.f21 == 'f21a'  && formData.f22 == 'f22b' &&  formData.f23 == 'f23b'">
          <p>grasa</p>
        </template>
      
    </template>
     <template x-if="formData.age == 'f25' && formData.f21 == 'f21c'  && formData.f22 == 'f22c' &&  formData.f23 == 'f23c'">
          <p>piel normale</p>
        </template>
          <template x-if="formData.age != 'f25'">
        <div>      Piel Madura<br></div>
    </template>

     

  </div>
  <script>


function customerupdate(formData2) {

const storeName = 'hilo-cosmetiques.myshopify.com';
const customerId = '{{ customer.id }}'; // replace with the ID of the customer you want to fetch
const metafieldId = '29093746475303'; // replace with the ID of the customer you want to fetch

var accessToken = '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';



// Construir la URL de la API de Shopify para actualizar el cliente
const url = `https://${storeName}/admin/api/2023-04/customers/${customerId}/metafields/${metafieldId}.json`;



// Construct the request options, including the new value of the metafield
const options = {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'X-Shopify-Access-Token': accessToken,
  },
  body: JSON.stringify({
    metafield: {
      value: '{"data":"$formData2"}',
    },
  }),
};

// Send the PUT request to update the customer metafield
fetch(url, options)
  .then((response) => {
    if (response.ok) {
      return response.json();
    }
    throw new Error('Error updating customer metafield');
  })
  .then((data) => {
    console.log('Customer metafield updated successfully:', data);
  })
  .catch((error) => {
    console.error('Error updating customer metafield:', error);
  });


};



</script>


<style>
  .step1 {
 background:#fdf8ed; border-color:#f5dfa5;
  }
  .step2 {
    background:#f2f8f1; border-color:#cde4ca;
  }
  .step3 {
    border-color:#b7daf3; background:#eef6fc;
    
  }
  .step4 {
    border-color:#F8C8D3; background:#FDEDF1;
  }
  
  label {
  display:block;
}
  legend {
    font-weight:500;
    margin-bottom:20px;
  }
  .active-step {
  background-color: #fbbf24;
}
</style>
{% schema %}
  {
    "name": "Section name",
    "settings": [],
   "presets": [
    {
      "name": "Quiz",
      "category": "Quiz by Sections.design",
      "blocks": [
      ]
    }
  ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}